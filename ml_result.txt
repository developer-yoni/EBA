================================================================================
ML 결과 요약 (Linear Regression, RAG 기반 테스트셋)
================================================================================

1) 이 문서가 말하는 것 (비전공자용)
- 우리는 '시장점유율'을 직접 맞추기보다, **GS 충전기 수**와 **시장 전체 충전기 수**를 각각 단순 추세(직선)로 예측한 뒤
  점유율 = (GS / 시장전체) × 100 으로 계산하는 방식을 평가했습니다.
- RAG(Knowledge Base)에서 월별 수치를 끌어와 **테스트셋(정답)**으로 쓰고, 여러 방식으로 오차를 측정했습니다.

2) 데이터(테스트셋) 출처
- 데이터 소스: s3_loader_fallback
- S3 Bucket: s3-eba-team3
- S3 Prefix: 충전인프라현황DB/
- 기간: 2024-12 ~ 2025-11 (총 12개월)
- 검증 목표 기간(요청 기준): 2024-12 ~ 2025-11

3) 평가 지표 설명 (핵심만, 쉬운 버전)
- MAE(%p): 예측 점유율과 실제 점유율의 **평균 차이(절대값)** 입니다. 예: MAE 0.20%p → 평균적으로 0.20%p 정도 틀림
- MAPE(%): 실제 대비 오차율의 평균입니다. 예: MAPE 1.5% → 실제값의 1.5%만큼 평균적으로 틀림
- 신뢰도(%): 여기서는 이해를 돕기 위해 **100 - MAPE** 로 표시했습니다(클수록 좋음).
- 참고: %p(퍼센트포인트)는 '퍼센트의 차이'입니다. 예: 16.0% → 16.2% 는 +0.2%p

4) 테스트 방법
- 롤링(rolling) 백테스트: 기준월을 계속 바꾸며 '과거 데이터로 학습 → 그 다음 달/그 다음 n개월을 예측'을 반복
- 시계열 교차검증(TimeSeriesSplit): 시간 순서를 지키는 방식으로 학습/검증을 여러 번 반복
- 사용한 예측 로직(현재 코드와 동일한 아이디어):
  1) GS 총충전기 수를 Linear Regression으로 예측
  2) 시장 전체 총충전기 수를 Linear Regression으로 예측
  3) 점유율(%) = (예측 GS / 예측 시장전체) × 100
- 사용한 파라미터(현재 스크립트/테스트 기준): 예측기간 1~8개월, 최소 학습 3개월
- 참고(시뮬레이터 입력 한계): 최대 예측기간 8개월, 최대 추가 설치 충전기 9,000대

5) 결과 요약
- 전체(모든 테스트 합산):
  - 테스트 수: 44개
  - MAE: 0.2797%p
  - RMSE: 0.332%p
  - MAPE: 1.72%
  - 신뢰도(=100-MAPE): 98.28%
  - 한 줄 결론: 평균적으로 **약 0.280%p 정도** 틀리며, 신뢰도(100-MAPE)는 **약 98.3%** 수준입니다.

- 예측기간(몇 개월 앞을 맞추는지)별 요약:
  | 예측기간 | 테스트수 | MAE(%p) | RMSE(%p) | MAPE(%) | 신뢰도(%) | 최악오차(%p) |
  |---:|---:|---:|---:|---:|---:|---:|
  | 1개월 | 9 | 0.1556 | 0.1986 | 0.95 | 99.05 | 0.3358 |
  | 2개월 | 8 | 0.2209 | 0.2794 | 1.34 | 98.66 | 0.4365 |
  | 3개월 | 7 | 0.2506 | 0.3104 | 1.53 | 98.47 | 0.4979 |
  | 4개월 | 6 | 0.3143 | 0.3454 | 1.93 | 98.07 | 0.4767 |
  | 5개월 | 5 | 0.3992 | 0.4273 | 2.46 | 97.54 | 0.4988 |
  | 6개월 | 4 | 0.4688 | 0.4825 | 2.9 | 97.1 | 0.6117 |
  | 7개월 | 3 | 0.3819 | 0.4071 | 2.37 | 97.63 | 0.5205 |
  | 8개월 | 2 | 0.2424 | 0.2632 | 1.5 | 98.5 | 0.345 |

- 시계열 교차검증(TimeSeriesSplit) 요약:
  - Fold 수: 5
  - 평가 포인트 수: 10
  - MAE: 0.2069%p
  - RMSE: 0.246%p
  - MAPE: 1.24%
  - 신뢰도(=100-MAPE): 98.76%

6) 해석 & 주의사항
- 이 방식은 '직선 추세'를 가정합니다. 시장이 갑자기 변하거나(정책/대형사업자 증설 등) 계절성이 크면 오차가 커질 수 있습니다.
- RAG에서 숫자를 추출할 때는 문서 조각/요약에 따라 누락될 수 있어, 월별 데이터가 충분히 확보되는지 확인이 필요합니다.
- 본 결과는 '현재 구현된 로직/파라미터' 기준의 정합성 점검이며, **복잡한 모델 없이도** 어느 정도 오차로 동작하는지 보여줍니다.
- 현재 결과 해석(요약):
  - 1~3개월 앞 예측은 평균 오차가 상대적으로 작고(약 0.16~0.25%p), 신뢰도(100-MAPE)도 높게 나옵니다.
  - 4~6개월로 갈수록 오차가 커지는 경향이 있어, 장기 예측은 '참고용'으로 두고 단기(1~3개월) 중심 활용이 안전합니다.
  - 7~8개월 예측은 표본 수가 적어(테스트 횟수가 적음) 지표가 흔들릴 수 있으니, 수치 자체보다는 '대략적인 참고'로 보시는 것이 안전합니다.

7) 참고: 기존 종합 분석(lr_analysis_*)과의 일관성
- lr_analysis_report.txt / lr_analysis_plots.png의 결론 요약: Ratio 방식이 Direct 방식보다 오차가 작고(약 15% 개선),
  시장 전체가 매우 선형(R²≈0.98)이라 점유율(비율)은 더 안정적으로 예측됨(R²≈0.96).
- 본 ml_result의 백테스트도 동일한 방향(단기일수록 더 정확, Ratio 기반 점유율은 작은 %p 오차)을 보이며,
  설정이 8개월/9000대로 확장되더라도 '기본 예측 로직(LinearRegression + Ratio)'의 정합성은 유지됩니다.

8) 생성된 파일
- ml_result.png: 핵심 그래프 1장(실제vs예측, 기간별 오차 분포, 산점도, 잔차분포)
- ml_result.txt: 이 문서

(재현) python ml_rag_evaluation_report.py