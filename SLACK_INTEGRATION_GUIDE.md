# 📤 슬랙 연동 기능 가이드

DataReporter에서 생성된 대시보드를 슬랙 채널로 자동 전송하는 기능입니다.

## 🚀 주요 기능

### 1. 대시보드 슬랙 전송
- 선택한 기간의 대시보드 데이터를 슬랙으로 전송
- GS차지비 KPI + 전체 시장 현황 요약
- 전월 대비 증감량 자동 계산
- 깔끔한 마크다운 형식으로 전송

### 2. 자동 데이터 포맷팅
- 숫자 천 단위 구분 (예: 459,523기)
- 증감량 표시 (+/- 기호 포함)
- 시장점유율 퍼센트 포인트 표시
- 생성 일시 자동 추가

## 📋 사용 방법

### 1. 웹 대시보드에서 사용
1. DataReporter 웹 대시보드 접속 (http://localhost:5001/dashboard)
2. 원하는 기간 선택 (시작월 ~ 종료월)
3. "📊 대시보드 생성" 버튼 클릭
4. 대시보드가 생성되면 "📤 슬랙으로 전송" 버튼 활성화
5. "📤 슬랙으로 전송" 버튼 클릭
6. 전송 완료 메시지 확인

### 2. API 직접 호출
```bash
curl -X POST http://localhost:5001/api/send-to-slack \
  -H "Content-Type: application/json" \
  -d '{
    "startMonth": "2025-10",
    "endMonth": "2025-11",
    "months": ["2025-10", "2025-11"]
  }'
```

## 🔧 설정 정보

### 슬랙 Webhook URL
```
환경 변수 SLACK_WEBHOOK_URL에서 설정
(.env 파일 또는 시스템 환경 변수 사용)
```

### MCP 서버 설정
파일: `DataReporter/.kiro/settings/mcp.json`
```json
{
  "mcpServers": {
    "slack": {
      "command": "cmd",
      "args": [
        "/c",
        "npx",
        "-y",
        "@smithery/cli@latest",
        "run",
        "slack",
        "--key",
        "YOUR_MCP_SLACK_KEY_HERE"
      ]
    }
  }
}
```

## 📊 전송되는 데이터

### GS차지비 KPI
- 시장점유율 (전월 대비 증감)
- 충전소 수 (전월 대비 증감)
- 총충전기 수 (전월 대비 증감)
- 완속충전기 수 (전월 대비 증감)
- 급속충전기 수 (전월 대비 증감)

### 전체 시장 현황
- 총 충전소 수
- 총 충전기 수 (전월 대비 증감)
- 완속충전기 수 (전월 대비 증감)
- 급속충전기 수 (전월 대비 증감)

## 📝 메시지 예시

```
📊 *EV 충전 인프라 분석 리포트*
━━━━━━━━━━━━━━━━━━━━━━
📅 분석 기간: *2025-11* (전월 대비 현황)

🔋 *GS차지비 현황*
• 시장점유율: *16.1%* (-0.1%p)
• 충전소: *7,431개* (+3)
• 총충전기: *73,851기* (+1,423)
• 완속충전기: *59,437기* (+896)
• 급속충전기: *14,414기* (+527)

📈 *전체 시장 현황*
• 총 충전소: 92,670개
• 총 충전기: *459,523기* (+6,457)
• 완속충전기: *410,205기* (+5,930)
• 급속충전기: *49,318기* (+527)

━━━━━━━━━━━━━━━━━━━━━━
🕐 생성: 2025-12-13 13:10
```

## 🔍 테스트 방법

### 1. 간단한 테스트
```bash
cd DataReporter
python simple_slack_test.py
```

### 2. 전체 기능 테스트
```bash
cd DataReporter
python test_slack_integration.py
```

## 🛠️ 트러블슈팅

### 1. 슬랙 전송 실패
- 네트워크 연결 확인
- Webhook URL 유효성 확인
- 슬랙 채널 권한 확인

### 2. 대시보드 데이터 없음
- 먼저 대시보드를 생성했는지 확인
- 선택한 기간에 데이터가 있는지 확인
- Flask 서버가 정상 실행 중인지 확인

### 3. 버튼이 활성화되지 않음
- 대시보드가 완전히 로드되었는지 확인
- 브라우저 콘솔에서 JavaScript 오류 확인
- 페이지 새로고침 후 재시도

## 📁 관련 파일

- `slack_sender.py`: 슬랙 전송 핵심 로직
- `app.py`: Flask API 엔드포인트 (`/api/send-to-slack`)
- `templates/index.html`: 웹 UI (슬랙 전송 버튼)
- `.kiro/settings/mcp.json`: MCP 서버 설정
- `simple_slack_test.py`: 간단한 테스트 스크립트

## 🎯 향후 개선 사항

1. **이미지/PDF 첨부**: 대시보드를 이미지나 PDF로 변환하여 첨부
2. **스케줄링**: 정기적으로 자동 전송하는 기능
3. **다중 채널**: 여러 슬랙 채널로 동시 전송
4. **커스텀 메시지**: 사용자가 메시지 내용을 커스터마이징
5. **알림 설정**: 특정 조건 달성 시 자동 알림

---

💡 **Tip**: 슬랙 전송 기능은 대시보드가 생성된 후에만 사용할 수 있습니다. 먼저 원하는 기간을 선택하고 대시보드를 생성한 다음 슬랙 전송 버튼을 클릭하세요!