#!/usr/bin/env python3
"""
ìˆ˜ì •ëœ ìŠ¬ë™ ë©”ì‹œì§€ í˜•ì‹ í…ŒìŠ¤íŠ¸
"""
import requests
import json

def test_updated_slack_message():
    """ìˆ˜ì •ëœ ìŠ¬ë™ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸"""
    print("ğŸ§ª ìˆ˜ì •ëœ ìŠ¬ë™ ë©”ì‹œì§€ í˜•ì‹ í…ŒìŠ¤íŠ¸...")
    
    url = "http://localhost:5001/api/slack-send"
    
    # ìˆ˜ì •ëœ ë©”ì‹œì§€ í˜•ì‹ (ì¢…ë£Œì›”ë§Œ í‘œì‹œ)
    test_message = """ğŸ“Š *EV ì¶©ì „ ì¸í”„ë¼ ë¶„ì„ ë¦¬í¬íŠ¸*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… ë¶„ì„ ê¸°ê°„: *2025-11* (ì „ì›” ëŒ€ë¹„ í˜„í™©)

ğŸ”‹ *GSì°¨ì§€ë¹„ í˜„í™©*
â€¢ ì‹œì¥ì ìœ ìœ¨: *16.1%* (-0.1%p)
â€¢ ì¶©ì „ì†Œ: *7,431ê°œ* (+3)
â€¢ ì´ì¶©ì „ê¸°: *73,851ê¸°* (+1,423)
â€¢ ì™„ì†ì¶©ì „ê¸°: *59,437ê¸°* (+896)
â€¢ ê¸‰ì†ì¶©ì „ê¸°: *14,414ê¸°* (+527)

ğŸ“ˆ *ì „ì²´ ì‹œì¥ í˜„í™©*
â€¢ ì´ ì¶©ì „ì†Œ: 92,670ê°œ
â€¢ ì´ ì¶©ì „ê¸°: *459,523ê¸°* (+6,457)
â€¢ ì™„ì†ì¶©ì „ê¸°: *410,205ê¸°* (+5,930)
â€¢ ê¸‰ì†ì¶©ì „ê¸°: *49,318ê¸°* (+527)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ• ìƒì„±: 2025-12-13 13:55
ğŸ¤– ìˆ˜ì •ëœ ë©”ì‹œì§€ í˜•ì‹ í…ŒìŠ¤íŠ¸ (ì¢…ë£Œì›”ë§Œ í‘œì‹œ)"""
    
    try:
        print(f"ğŸ“¡ API í˜¸ì¶œ: {url}")
        print(f"ğŸ“¤ ë©”ì‹œì§€ ê¸¸ì´: {len(test_message)} ì")
        print(f"ğŸ“… ë¶„ì„ ê¸°ê°„ í˜•ì‹: '2025-11 (ì „ì›” ëŒ€ë¹„ í˜„í™©)' - ì¢…ë£Œì›”ë§Œ í‘œì‹œ")
        
        response = requests.post(
            url,
            json={'message': test_message},
            headers={'Content-Type': 'application/json'},
            timeout=15
        )
        
        print(f"ğŸ“¡ ì‘ë‹µ ìƒíƒœ: {response.status_code}")
        
        if response.status_code == 200:
            result = response.json()
            print(f"âœ… JSON ì‘ë‹µ: {result}")
            
            if result.get('success'):
                print("ğŸ‰ ìˆ˜ì •ëœ ìŠ¬ë™ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ ì„±ê³µ!")
                print("ğŸ“ ìŠ¬ë™ì—ì„œ 'ë¶„ì„ ê¸°ê°„: 2025-11 (ì „ì›” ëŒ€ë¹„ í˜„í™©)' í˜•ì‹ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.")
                return True
            else:
                print(f"âŒ API ì˜¤ë¥˜: {result.get('error')}")
                return False
        else:
            print(f"âŒ HTTP ì˜¤ë¥˜: {response.status_code}")
            print(f"ğŸ“„ ì‘ë‹µ: {response.text}")
            return False
            
    except Exception as e:
        print(f"âŒ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: {e}")
        return False

if __name__ == '__main__':
    print("ğŸš€ ìˆ˜ì •ëœ ìŠ¬ë™ ë©”ì‹œì§€ í˜•ì‹ í…ŒìŠ¤íŠ¸")
    print("=" * 60)
    
    success = test_updated_slack_message()
    
    print("=" * 60)
    if success:
        print("ğŸ‰ ë©”ì‹œì§€ í˜•ì‹ ìˆ˜ì • ì™„ë£Œ!")
        print("ğŸ’¡ ì´ì œ ìŠ¬ë™ ë©”ì‹œì§€ì—ì„œ 'ë¶„ì„ ê¸°ê°„: ì¢…ë£Œì›” (ì „ì›” ëŒ€ë¹„ í˜„í™©)' í˜•ì‹ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.")
    else:
        print("âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨")
        print("ğŸ”§ ì„œë²„ë‚˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.")