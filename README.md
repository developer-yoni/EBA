# β΅ ν•κµ­ μ „κΈ°μ°¨ μ¶©μ „ μΈν”„λΌ μλ™ λ¶„μ„ λ¦¬ν¬νΈ μ‹μ¤ν…

AWS Bedrock + Knowledge Baseλ¥Ό ν™μ©ν• μ¶©μ „ μΈν”„λΌ ν„ν™© μλ™ λ¶„μ„ λ° λ¦¬ν¬νΈ μƒμ„± μ›Ήμ•±

## π― μ£Όμ” κΈ°λ¥

### 1. μλ™ λ°μ΄ν„° μμ§‘
- S3μ—μ„ μ›”λ³„ μ¶©μ „ μΈν”„λΌ ν„ν™© μ—‘μ…€ νμΌ μλ™ λ΅λ“
- μ¤λƒ…μƒ· λ‚ μ§ μλ™ νμ‹± (μ λ©μ—μ„ YY.MM.DD μ¶”μ¶)
- λ‹¤μ¤‘ νμΌ λ³‘ν•© λ° μ‹κ³„μ—΄ λ¶„μ„ μ§€μ›

### 2. λ°μ΄ν„° λ¶„μ„
- CPO(μ¶©μ „μ‚¬μ—…μ)λ³„ ν„ν™© λ¶„μ„
- μ§€μ—­λ³„ μΈν”„λΌ λ¶„ν¬ λ¶„μ„
- μ¶©μ „κΈ° μ ν•λ³„ ν†µκ³„
- μ‹κ³„μ—΄ νΈλ λ“ λ¶„μ„
- μƒμ„ μ‚¬μ—…μ μμ„

### 3. AI κΈ°λ° λ¦¬ν¬νΈ μƒμ„±
- **κ²½μμ§„ μ”μ•½**: ν•µμ‹¬ μΈμ‚¬μ΄νΈ λ° κ¶μ¥μ‚¬ν•­
- **CPO λ¶„μ„**: μ‚¬μ—…μλ³„ μ‹μ¥ ν¬μ§€μ… λ° κ²½μ κµ¬λ„
- **μ§€μ—­λ³„ λ¶„μ„**: μ§€μ—­ κ²©μ°¨ λ° κ°μ„  λ°©μ•
- **νΈλ λ“ μμΈ΅**: μ„±μ¥ μ¶”μ„Έ λ° ν–¥ν›„ μ „λ§

### 4. λ€ν™”ν• μ§μμ‘λ‹µ
- Knowledge Base κΈ°λ° μ»¤μ¤ν…€ μ§μ
- μ‹¤μ‹κ°„ λ°μ΄ν„° κΈ°λ° λ‹µλ³€ μƒμ„±

### 5. π“¤ μ¬λ™ μ—°λ™
- λ€μ‹λ³΄λ“ μλ™ μ „μ†΅ κΈ°λ¥
- GSμ°¨μ§€λΉ„ KPI + μ „μ²΄ μ‹μ¥ ν„ν™© μ”μ•½
- μ „μ›” λ€λΉ„ μ¦κ°λ‰ μλ™ κ³„μ‚°
- μ‹¤μ‹κ°„ μ¬λ™ μ±„λ„ μ•λ¦Ό

## π—οΈ μ‹μ¤ν… μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   S3 Bucket     β”‚  μ¶©μ „μΈν”„λΌ ν„ν™© μ—‘μ…€ νμΌ
β”‚ s3-eba-team3    β”‚  (μ›”λ³„ μ¤λƒ…μƒ·)
β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
         β”‚
         β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Data Loader    β”‚  νμΌ λ‹¤μ΄λ΅λ“ λ° νμ‹±
β”‚  (data_loader)  β”‚  - λ‚ μ§ μ¶”μ¶
β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”  - λ°μ΄ν„° μ •μ 
         β”‚
         β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Data Analyzer   β”‚  ν†µκ³„ λ¶„μ„ λ° μ§‘κ³„
β”‚ (data_analyzer) β”‚  - CPOλ³„/μ§€μ—­λ³„
β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”  - νΈλ λ“ λ¶„μ„
         β”‚
         β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  AI Report Generator            β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β”‚  β”‚   Bedrock    β”‚  β”‚    KB    β”‚ β”‚
β”‚  β”‚ Claude 4.5   β”‚β—„β”€β”¤ XHG5MM.. β”‚ β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
         β”‚
         β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   Flask Web     β”‚  λ€μ‹λ³΄λ“ λ° API
β”‚   (app.py)      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π“¦ μ„¤μΉ λ° μ„¤μ •

### 1. μμ΅΄μ„± μ„¤μΉ

```bash
pip install -r requirements.txt
```

### 2. ν™κ²½ λ³€μ μ„¤μ •

`.env.example`μ„ `.env`λ΅ λ³µμ‚¬ν•κ³  μ„¤μ •:

```bash
cp .env.example .env
```

`.env` νμΌ λ‚΄μ©:
```env
# AWS μκ²© μ¦λ… (μ„ νƒμ‚¬ν•­ - IAM Role μ‚¬μ© μ‹ λ¶ν•„μ”)
# AWS_ACCESS_KEY_ID=your_access_key
# AWS_SECRET_ACCESS_KEY=your_secret_key

AWS_REGION=ap-northeast-2
S3_BUCKET=s3-eba-team3
S3_PREFIX=μ¶©μ „μΈν”„λΌν„ν™©DB/
KNOWLEDGE_BASE_ID=XHG5MMFIYK
MODEL_ID=global.anthropic.claude-sonnet-4-5-20250929-v1:0
```

### 3. AWS μκ²© μ¦λ…

λ‹¤μ μ¤‘ ν•λ‚μ λ°©λ²•μΌλ΅ μ„¤μ •:

**λ°©λ²• 1: IAM Role (κ¶μ¥)**
- EC2, Lambda λ“±μ—μ„ μ‹¤ν–‰ μ‹ μλ™ μΈμ¦

**λ°©λ²• 2: ν™κ²½ λ³€μ**
- `.env` νμΌμ— Access Key μ„¤μ •

**λ°©λ²• 3: AWS CLI**
```bash
aws configure
```

## π€ μ‹¤ν–‰ λ°©λ²•

### μ›Ή μ•± μ‹¤ν–‰

```bash
python app.py
```

λΈλΌμ°μ €μ—μ„ `http://localhost:5001/dashboard` μ ‘μ†

### π“¤ μ¬λ™ μ—°λ™ μ‚¬μ©λ²•

1. **λ€μ‹λ³΄λ“ μƒμ„±**
   - μ›Ή λ€μ‹λ³΄λ“μ—μ„ μ›ν•λ” κΈ°κ°„ μ„ νƒ
   - "π“ λ€μ‹λ³΄λ“ μƒμ„±" λ²„νΌ ν΄λ¦­

2. **μ¬λ™ μ „μ†΅**
   - λ€μ‹λ³΄λ“ μƒμ„± ν›„ "π“¤ μ¬λ™μΌλ΅ μ „μ†΅" λ²„νΌ ν΄λ¦­
   - μλ™μΌλ΅ μ¬λ™ μ±„λ„μ— λ¦¬ν¬νΈ μ „μ†΅

3. **API μ§μ ‘ νΈμ¶**
   ```bash
   curl -X POST http://localhost:5001/api/send-to-slack \
     -H "Content-Type: application/json" \
     -d '{"startMonth": "2025-10", "endMonth": "2025-11"}'
   ```

μμ„Έν• λ‚΄μ©μ€ [μ¬λ™ μ—°λ™ κ°€μ΄λ“](SLACK_INTEGRATION_GUIDE.md)λ¥Ό μ°Έμ΅°ν•μ„Έμ”.

### CLI μ‹¤ν–‰ (μ›Ή μ„λ²„ μ—†μ΄)

```bash
python cli_runner.py
```

κ²°κ³Όλ” `charging_infrastructure_report.json`μ— μ €μ¥λ©λ‹λ‹¤.

## π“ λ°μ΄ν„° κµ¬μ΅°

### μ—‘μ…€ νμΌ ν•μ‹

```
νμΌλ…: μ¶©μ „μΈν”„λΌ ν„ν™©_YYMM.xlsx
μ‹νΈ: Sheet1

[0ν–‰, 2μ—΄] μ λ©: "KR CHARING INFRASTRUCTURE STATUS_YY.MM.DD"
[4ν–‰] ν—¤λ”: CPOλ…, μ§€μ—­, μ¶©μ „κΈ°μ, ...
[5ν–‰~] λ°μ΄ν„°
```

### μλ™ μƒμ„± μ»¬λΌ

- `snapshot_date`: YYYY-MM-DD ν•μ‹
- `snapshot_month`: YYYY-MM ν•μ‹
- `data_source`: S3 ν‚¤

## π”§ μ£Όμ” λ¨λ“

### `config.py`
ν™κ²½ μ„¤μ • κ΄€λ¦¬

### `data_loader.py`
- S3 νμΌ λ©λ΅ μ΅°ν
- νμΌ λ‹¤μ΄λ΅λ“
- μ¤λƒ…μƒ· λ‚ μ§ νμ‹±
- λ°μ΄ν„° λ΅λ“ λ° μ •μ 

### `data_analyzer.py`
- CPOλ³„ λ¶„μ„
- μ§€μ—­λ³„ λ¶„μ„
- μ¶©μ „κΈ° μ ν•λ³„ λ¶„μ„
- νΈλ λ“ λ¶„μ„
- μƒμ„ μ‚¬μ—…μ λ¶„μ„

### `ai_report_generator.py`
- Knowledge Base κ²€μƒ‰
- Bedrock λ¨λΈ νΈμ¶
- λ¦¬ν¬νΈ μ„Ήμ…λ³„ μƒμ„±
  - κ²½μμ§„ μ”μ•½
  - CPO λ¶„μ„
  - μ§€μ—­λ³„ λ¶„μ„
  - νΈλ λ“ μμΈ΅

### `app.py`
Flask μ›Ή μ„λ²„ λ° API μ—”λ“ν¬μΈνΈ

## π API μ—”λ“ν¬μΈνΈ

### `GET /`
λ©”μΈ λ€μ‹λ³΄λ“

### `GET /api/files`
S3 νμΌ λ©λ΅ μ΅°ν

### `POST /api/load`
λ°μ΄ν„° λ΅λ“
```json
{
  "file_key": "μ¶©μ „μΈν”„λΌν„ν™©DB/μ¶©μ „μΈν”„λΌ ν„ν™©_2510.xlsx"  // μ„ νƒμ‚¬ν•­
}
```

### `GET /api/analyze`
λ°μ΄ν„° λ¶„μ„ μ‹¤ν–‰

### `GET /api/generate-report`
AI λ¦¬ν¬νΈ μƒμ„±

### `POST /api/query`
μ»¤μ¤ν…€ μ§μ
```json
{
  "query": "μ„μΈ μ§€μ—­μ μ¶©μ „ μΈν”„λΌ ν„ν™©μ€?"
}
```

## π“ μ‚¬μ© μμ‹

### 1. μ›Ή μΈν„°νμ΄μ¤

1. "μµμ‹  λ°μ΄ν„° λ΅λ“" ν΄λ¦­
2. "λ°μ΄ν„° λ¶„μ„" ν΄λ¦­
3. "AI λ¦¬ν¬νΈ μƒμ„±" ν΄λ¦­ (1-2λ¶„ μ†μ”)
4. μƒμ„±λ λ¦¬ν¬νΈ ν™•μΈ
5. μ»¤μ¤ν…€ μ§μλ΅ μ¶”κ°€ λ¶„μ„

### 2. CLI

```bash
python cli_runner.py
```

μλ™μΌλ΅ μ „μ²΄ ν”„λ΅μ„Έμ¤ μ‹¤ν–‰:
1. μµμ‹  νμΌ λ΅λ“
2. λ°μ΄ν„° λ¶„μ„
3. AI λ¦¬ν¬νΈ μƒμ„±
4. JSON νμΌλ΅ μ €μ¥

## π” ν•„μ”ν• IAM κ¶ν•

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::s3-eba-team3",
        "arn:aws:s3:::s3-eba-team3/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel"
      ],
      "Resource": "arn:aws:bedrock:*::foundation-model/*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:Retrieve"
      ],
      "Resource": "arn:aws:bedrock:ap-northeast-2:*:knowledge-base/XHG5MMFIYK"
    }
  ]
}
```

## π¨ μ»¤μ¤ν„°λ§μ΄μ§•

### λ°μ΄ν„° κµ¬μ΅° λ³€κ²½

`config.py`μ—μ„ ν—¤λ” ν–‰ μ„μΉ μ΅°μ •:
```python
HEADER_ROW = 4  # 0-based index
TITLE_ROW = 0
TITLE_COL = 2
```

### λ¶„μ„ λ΅μ§ μ¶”κ°€

`data_analyzer.py`μ `ChargingDataAnalyzer` ν΄λμ¤μ— λ©”μ„λ“ μ¶”κ°€

### λ¦¬ν¬νΈ μ„Ήμ… μ¶”κ°€

`ai_report_generator.py`μ `AIReportGenerator` ν΄λμ¤μ— λ©”μ„λ“ μ¶”κ°€

## π› νΈλ¬λΈ”μν…

### "Unable to locate credentials"
- `.env` νμΌ ν™•μΈ
- AWS CLI μ„¤μ • ν™•μΈ
- IAM Role κ¶ν• ν™•μΈ

### "No module named 'openpyxl'"
```bash
pip install openpyxl
```

### S3 νμΌ μ ‘κ·Ό μ¤λ¥
- S3 λ²„ν‚· μ΄λ¦„ ν™•μΈ
- IAM κ¶ν• ν™•μΈ
- λ¦¬μ „ μ„¤μ • ν™•μΈ

### Bedrock νΈμ¶ μ¤λ¥
- λ¨λΈ ID ν™•μΈ
- λ¦¬μ „μ—μ„ λ¨λΈ μ‚¬μ© κ°€λ¥ μ—¬λ¶€ ν™•μΈ
- IAM κ¶ν• ν™•μΈ

## π“„ λΌμ΄μ„ μ¤

MIT License

## π‘¥ κΈ°μ—¬

μ΄μ λ° PR ν™μν•©λ‹λ‹¤!
